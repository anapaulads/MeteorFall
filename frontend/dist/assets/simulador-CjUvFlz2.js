import"./modulepreload-polyfill-B5Qt9EMX.js";Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjZTQ4YmU0Mi1jNjRiLTRmZTEtOGU5Mi0zOWY5YzFhZTljYTkiLCJpZCI6MzQ3MjAxLCJpYXQiOjE3NTk3MTQ5MTB9.YT6r6H1Fol-tm3ksnj1oWs-IeBf07RyOwbu3LqywhqU";const C="AIzaSyBQ4WoMTxYQOMznMsR3o9Y2w9ia9hBmRTE";let l,i={selectedMeteor:null,impactLocation:null},c=null,r=[];document.addEventListener("DOMContentLoaded",f);async function f(){const e=new URLSearchParams(window.location.search);if(i.selectedMeteor={name:e.get("name"),size:parseFloat(e.get("size")),velocity:parseFloat(e.get("velocity"))},!i.selectedMeteor.name||isNaN(i.selectedMeteor.size)){window.location.href="/pages/lista.html";return}l=new Cesium.Viewer("cesium-container",{animation:!1,baseLayerPicker:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!1,shouldAnimate:!0}),E(),I(),y()}function E(){document.getElementById("meteor-name").textContent=i.selectedMeteor.name,document.getElementById("meteor-size").textContent=`${i.selectedMeteor.size.toFixed(0)} m`,document.getElementById("meteor-velocity").textContent=`${i.selectedMeteor.velocity.toFixed(2)} km/s`}function I(){new Cesium.ScreenSpaceEventHandler(l.scene.canvas).setInputAction(t=>{if(!document.getElementById("warning-panel").classList.contains("hidden")||!document.getElementById("results-panel").classList.contains("hidden")||!document.getElementById("evacuation-panel").classList.contains("hidden"))return;const o=l.camera.pickEllipsoid(t.position,l.scene.globe.ellipsoid);if(o){const a=Cesium.Cartographic.fromCartesian(o);h(Cesium.Math.toDegrees(a.latitude),Cesium.Math.toDegrees(a.longitude),a.height)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),document.getElementById("simulate-button").addEventListener("click",T),document.getElementById("reset-button").addEventListener("click",k),document.getElementById("cancel-simulation-btn").addEventListener("click",v),document.getElementById("show-evacuation-btn").addEventListener("click",w),document.getElementById("close-evacuation-btn").addEventListener("click",B)}function w(){const e=document.getElementById("evacuation-panel"),t=document.getElementById("evacuation-asteroid-name");t.textContent=i.selectedMeteor.name,e.classList.remove("hidden")}function B(){document.getElementById("evacuation-panel").classList.add("hidden")}function v(){document.getElementById("warning-panel").classList.add("hidden"),document.getElementById("control-panel").classList.remove("hidden"),i.impactLocation=null,c&&l.entities.remove(c),c=null,document.querySelector("#location-data span").textContent="Nenhum selecionado"}function y(){const e=document.getElementById("location-search-input");if(window.google&&window.google.maps){const t=new google.maps.places.Autocomplete(e);t.addListener("place_changed",()=>{const n=t.getPlace();n.geometry&&n.geometry.location&&h(n.geometry.location.lat(),n.geometry.location.lng(),1,n.formatted_address)})}else setTimeout(y,500)}async function h(e,t,n,o=null){const a=document.querySelector("#location-data span");i.impactLocation={lat:e,lon:t,elevation:n},c&&l.entities.remove(c),c=l.entities.add({position:Cesium.Cartesian3.fromDegrees(t,e),point:{pixelSize:15,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:3}});const u=o||await M(e,t);a.textContent=u,document.getElementById("control-panel").classList.add("hidden"),document.getElementById("warning-panel").classList.remove("hidden")}async function M(e,t){const n=document.querySelector("#location-data span");n.textContent="Buscando local...";try{const a=await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${e},${t}&key=${C}`)).json();return a.results[0]?a.results[0].formatted_address:`Lat: ${e.toFixed(2)}, Lon: ${t.toFixed(2)}`}catch{return`Lat: ${e.toFixed(2)}, Lon: ${t.toFixed(2)}`}}async function x(e,t){c&&(e.entities.remove(c),c=null);const n=4,o=4e5,a=Cesium.Cartesian3.fromDegrees(t.lon,t.lat,o),u=Cesium.Cartesian3.fromDegrees(t.lon,t.lat,t.elevation>0?t.elevation:0),s=e.entities.add({position:a,model:{uri:"/assets/meteor.glb",minimumPixelSize:128,maximumScale:25e3}});e.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(t.lon+.8,t.lat-.8,o/4),orientation:{heading:Cesium.Math.toRadians(-45),pitch:Cesium.Math.toRadians(-30),roll:0},duration:2}),await new Promise(p=>setTimeout(p,2500));const m=e.clock.currentTime.clone(),g=Cesium.JulianDate.addSeconds(m,n,new Cesium.JulianDate),d=new Cesium.SampledPositionProperty;d.addSample(m,a),d.addSample(g,u),s.position=d,s.orientation=new Cesium.VelocityOrientationProperty(d),e.trackedEntity=s,await new Promise(p=>{setTimeout(()=>{e.entities.contains(s)&&e.entities.remove(s),e.trackedEntity=void 0,p()},n*1e3)})}function L(e,t,n){r.length>0&&(r.forEach(m=>e.entities.remove(m)),r=[]);const o=n*1e3/2;if(o<=0)return;const a=2.5,u=e.clock.currentTime.clone(),s=new Cesium.CallbackProperty(function(m,g){const d=Cesium.JulianDate.secondsDifference(m,u),p=Math.min(d/a,1);return o*p},!1);r.push(e.entities.add({position:Cesium.Cartesian3.fromDegrees(t.lon,t.lat),ellipse:{semiMinorAxis:s,semiMajorAxis:s,material:Cesium.Color.RED.withAlpha(.4),clampToGround:!0}})),r.push(e.entities.add({position:Cesium.Cartesian3.fromDegrees(t.lon,t.lat),ellipse:{semiMinorAxis:s,semiMajorAxis:s,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.25,color:Cesium.Color.ORANGERED}),clampToGround:!0,fill:!1,outline:!0,outlineColor:Cesium.Color.ORANGERED,outlineWidth:2}}))}async function T(){const e=document.getElementById("warning-panel"),t=document.getElementById("results-panel");if(!(!i.selectedMeteor||!i.impactLocation)){e.classList.add("hidden"),await x(l,i.impactLocation),t.classList.remove("hidden"),t.querySelector("h2").textContent="Calculando Impacto...";try{const n=await fetch("/api/calculate_impact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({size:i.selectedMeteor.size,velocity:i.selectedMeteor.velocity,elevation:i.impactLocation.elevation})});if(!n.ok)throw new Error("Falha na conexão com o backend.");const o=await n.json();t.querySelector("h2").textContent="Resultados do Impacto",document.getElementById("result-velocity").textContent=`${o.impact_velocity_km_s} km/s`,document.getElementById("result-energy").textContent=`${o.energy_megatons} Megatons`,document.getElementById("result-crater").textContent=`${o.crater_diameter_km} km`,document.getElementById("result-magnitude").textContent=`${o.seismic_magnitude}`,document.getElementById("result-hiroshima").textContent=`~${o.hiroshima_equivalent.toLocaleString("pt-BR")}`,document.getElementById("result-tsar").textContent=`~${o.tsar_bombs_equivalent.toLocaleString("pt-BR")}`,L(l,i.impactLocation,o.crater_diameter_km)}catch(n){console.error("Erro ao calcular impacto:",n),t.querySelector("h2").textContent="Erro na Simulação"}}}function k(){r.length>0&&(r.forEach(e=>l.entities.remove(e)),r=[]),window.location.href="/pages/lista.html"}
